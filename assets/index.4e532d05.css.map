{"mappings":"AE4NI,8DAgCE,6FAIA,wFCoGJ,0E,oDC5QF,qD,+DC3BA,sR,2WCnBE,sFAIA,kMASE,2E,+C,6OC4CJ,8FAME,sEAIA,2DAIF,uCAGA,mFAIA,qCAGA,8C,4E,4C,2C,+CL8FE,8CAGE,sDAAA,8DAGA,gLAWE,iEAGF,kG,uDASE,iE,0DAMA,8EAAA,6FAIA,0DAAA,wFAGE,oD,+HMjNR,iH,iDCuHA,iDAGE,+C,kECrBF,4CAGE,kDAGE,+F,4PCwBF,kDAGE,gFAGE,oD,uE,8GC5HN,sC,mVCuFI,sHAQA,+IAIA,8IAUE,4DAGF,uDAGF,sIAQE,0FAIA,oF,+J,4EC/IF,qDAGE,oLAYA,yE,yQCZA,iGAIA,kL,qD,mEZwSF,yDAGE,wDAcA,kMAOF,6EAIE,sHAKE,o3B,qiCAOA,mEAGF,6HCzSF,6EAIA,+EAIF,mMAYE,wDAIF,6DAIE,4D,4EYuFF,kDAGE,mIAKA,0EAIF,+DAGA,0GAGE,0F","sources":["assets/index.4e532d05.css","9900ce7f53d86402","src/vue/components/ControlPanelTabParameterTransforms.vue","src/vue/components/ModelVisualization.vue","src/vue/components/ResetTimeoutOverlay.vue","src/vue/components/ScaledLetterbox.vue","src/vue/components/MarkerUnderlay.vue","src/vue/components/ScoreTable.vue","src/vue/components/ControlPanelTabRawData.vue","src/vue/components/ControlPanelTabImportExport.vue","src/vue/components/ControlPanelTabMisc.vue","src/vue/components/ControlPanel.vue","src/vue/components/ConditionalLayer.vue","src/vue/components/MarkerSlot.vue","src/vue/components/GameCard.vue","src/vue/components/CardSlot.vue","src/vue/components/App.vue"],"sourcesContent":[".parameter-transforms > :last-child textarea, .parameter-transforms > :last-child input[type=\"text\"] {\n  width: 100%;\n}\n\n.parameter-transforms .available > div .edit, .parameter-transforms .available > div input[type=\"checkbox\"] {\n  margin-left: .5ex;\n  margin-right: .5ex;\n}\n\n.parameter-transforms .available > div .edit, .parameter-transforms .available > div input[type=\"checkbox\"]:not(:disabled) {\n  cursor: pointer;\n}\n\n@keyframes highlight-b9d3e8 {\n  0% {\n    stroke: red;\n  }\n\n  50% {\n    stroke: gray;\n  }\n\n  100% {\n    stroke: #00f;\n  }\n}\n\n@keyframes fadeIn-80321f {\n  0% {\n    opacity: 0;\n  }\n\n  100% {\n    opacity: 1;\n  }\n}\n\n@keyframes fadeOut-80321f {\n  0% {\n    opacity: 1;\n  }\n\n  100% {\n    opacity: 0;\n  }\n}\n\n.outer[data-v-70f7f0] {\n  width: 100%;\n  height: 100%;\n  position: relative;\n}\n\n.inner[data-v-70f7f0] {\n  width: calc(1px * var(--target-width));\n  height: calc(1px * var(--target-height));\n  transform-origin: 0 0;\n  transform: translateX(calc(1px * var(--translate-x))) translateY(calc(1px * var(--translate-y))) scale(var(--scale)) translate(-50%, -50%);\n  position: absolute;\n  top: 0;\n  left: 0;\n}\n\n.marker[data-v-9f6c2c] {\n  --blur-radius: 15px;\n  --outline-width: 6px;\n  left: calc(1px * var(--marker-position-x));\n  top: calc(1px * var(--marker-position-y));\n  width: calc(1px * var(--marker-diameter));\n  height: calc(1px * var(--marker-diameter));\n  transform-origin: 0 0;\n  place-items: center;\n  font-family: sans-serif;\n  font-size: x-large;\n  display: grid;\n  position: absolute;\n  transform: translate(-50%, -50%);\n}\n\n.marker [data-v-9f6c2c] {\n  pointer-events: none;\n  -webkit-user-select: none;\n  user-select: none;\n}\n\n.marker .circle[data-v-9f6c2c] {\n  filter: blur(var(--blur-radius));\n  background-color: #d3d3d380;\n  border-radius: 50%;\n  outline: 6px solid #000000bf;\n  width: 100%;\n  height: 100%;\n  position: absolute;\n}\n\n.marker .circle.active[data-v-9f6c2c] {\n  background-color: #37afda80;\n}\n\n.marker-underlay[data-v-f20b9f] {\n  cursor: pointer;\n}\n\n.scores[data-v-c07580] {\n  table-layout: fixed;\n  color: #fff;\n  text-transform: uppercase;\n  white-space: pre;\n  background-color: #e10984;\n  border-radius: 50%;\n  width: 395px;\n  height: 395px;\n  margin: 44px;\n  font-size: 20px;\n  line-height: 1.2;\n  display: table;\n  position: absolute;\n}\n\n.score-table[data-v-c07580] {\n  position: absolute;\n  top: 50%;\n  left: 50%;\n  transform: translate(-50%, -50%);\n}\n\ntable[data-v-c07580] {\n  border-collapse: separate;\n  border-spacing: 1ex .5em;\n}\n\n.header[data-v-c07580] {\n  padding-top: .5em;\n  padding-bottom: 1em;\n}\n\n.footer[data-v-c07580] {\n  padding-top: 1em;\n}\n\ntr:first-child > td[data-v-c07580], tr:last-child > td[data-v-c07580] {\n  text-align: center;\n}\n\ntd[data-v-c07580] {\n  vertical-align: top;\n}\n\n.score-column[data-v-c07580] {\n  text-align: right;\n}\n\n.score-value[data-v-c07580] {\n  text-align: right;\n  width: 8ex;\n  display: inline-block;\n}\n\ninput[type=\"range\"][data-v-da743b] {\n  width: 100%;\n}\n\n.parameter-transforms {\n  gap: 2em;\n  display: flex;\n}\n\n.parameter-transforms > :first-child {\n  flex-grow: 0;\n}\n\n.parameter-transforms > :last-child {\n  flex-grow: 3;\n}\n\n.parameter-transforms > :last-child textarea, .parameter-transforms > :last-child input[type=\"text\"] {\n  width: 100%;\n}\n\n.parameter-transforms .available {\n  -ms-overflow-style: none;\n  scrollbar-width: none;\n  border: 1px solid;\n  min-width: 300px;\n  max-width: 300px;\n  min-height: 20px;\n  max-height: 900px;\n  overflow: scroll;\n}\n\n.parameter-transforms .available::-webkit-scrollbar {\n  display: none;\n}\n\n.parameter-transforms .available > div {\n  outline: 1px solid;\n  flex-wrap: nowrap;\n  padding: .2ex;\n  display: flex;\n}\n\n.parameter-transforms .available > div label {\n  flex-grow: 1;\n}\n\n.parameter-transforms .available > div label.draggable {\n  cursor: grab;\n}\n\n.parameter-transforms .available > div > * {\n  white-space: nowrap;\n}\n\n.parameter-transforms .available > div .edit, .parameter-transforms .available > div input[type=\"checkbox\"] {\n  margin-left: .5ex;\n  margin-right: .5ex;\n}\n\n.parameter-transforms .available > div .edit, .parameter-transforms .available > div input[type=\"checkbox\"]:not(:disabled) {\n  cursor: pointer;\n}\n\n.slot-group-transforms {\n  height: 700px;\n  overflow: scroll;\n}\n\n.container[data-v-f24568] {\n  flex-flow: column wrap;\n  justify-content: flex-start;\n  width: 800px;\n  height: 800px;\n  margin-left: 0;\n  display: flex;\n}\n\n.preformatted[data-v-f24568] {\n  white-space: pre;\n  width: 30%;\n  margin-bottom: 3em;\n  font-family: monospace;\n  font-size: x-small;\n}\n\n.success[data-v-6adaee] {\n  background-color: #90ee90;\n}\n\n.unknown[data-v-6adaee] {\n  background-color: #ffffe0;\n}\n\n.error[data-v-6adaee] {\n  background-color: #f08080;\n}\n\n.btn[data-v-31cd2e], .btn-check[data-v-31cd2e] {\n  margin-bottom: .5rem;\n}\n\n.scale-factors[data-v-31cd2e] {\n  display: table;\n}\n\n.scale-factors > p[data-v-31cd2e] {\n  display: table-row;\n}\n\n.scale-factors > p > label[data-v-31cd2e], .scale-factors > p > input[data-v-31cd2e] {\n  display: table-cell;\n}\n\n.control-panel[data-v-88ca19] {\n  width: calc(1px * var(--app-width) / 4);\n  box-sizing: border-box;\n  transform-origin: 100% 0;\n  background-color: #fff;\n  border-left: 1px solid;\n  flex-direction: column;\n  height: 50%;\n  display: flex;\n  position: absolute;\n  top: 0;\n  right: 0;\n  transform: scale(2);\n}\n\n.control-panel nav[data-v-88ca19] {\n  padding-top: 1ex;\n}\n\n.control-panel nav button[disabled][data-v-88ca19] {\n  text-decoration: line-through;\n}\n\n.control-panel .tab-pane[data-v-88ca19] {\n  padding: 1em;\n}\n\n.control-panel .tab-content[data-v-88ca19] {\n  flex-grow: 2;\n  overflow: scroll;\n}\n\n.positioned-layer[data-v-a2975c] {\n  top: calc(1px * var(--layer-y));\n  left: calc(1px * var(--layer-x));\n  position: absolute;\n}\n\n.inactive[data-v-a2975c] {\n  display: none;\n}\n\n.slot[data-v-c64c16] {\n  left: calc(1px * var(--slot-x));\n  top: calc(1px * var(--slot-y));\n  width: calc(1px * var(--slot-diameter));\n  height: calc(1px * var(--slot-diameter));\n  transform-origin: center;\n  transform: translate(-50%, -50%) rotate(var(--slot-angle));\n  text-align: center;\n  place-items: center;\n  font-family: sans-serif;\n  font-size: x-large;\n  display: grid;\n  position: absolute;\n}\n\n.slot > .asset-container[data-v-c64c16] {\n  width: 100%;\n  height: 100%;\n  position: absolute;\n  top: 0;\n  left: 0;\n  transform: translate(0%, 50%);\n}\n\n.slot > .asset-container > img[data-v-c64c16] {\n  transform: translateX(calc(1px * var(--asset-x))) translateY(calc(1px * var(--asset-y)));\n  position: absolute;\n}\n\n.slot > .circle[data-v-c64c16] {\n  box-sizing: content-box;\n  border-radius: 50%;\n  outline: 2px solid;\n  width: 100%;\n  height: 100%;\n  position: absolute;\n  top: 0;\n  left: 0;\n}\n\n.slot > .circle.inactive[data-v-c64c16] {\n  outline-color: #a9a9a9;\n}\n\n.slot > .circle.active[data-v-c64c16] {\n  outline-color: #000;\n}\n\n.slot .label[data-v-c64c16] {\n  text-align: left;\n  text-transform: uppercase;\n  white-space: pre-line;\n  color: #000;\n  font-size: 20px;\n  position: absolute;\n}\n\n.slot .dev-label[data-v-c64c16] {\n  background-color: #fffa;\n  position: absolute;\n}\n\n.slot [data-v-c64c16] {\n  pointer-events: none;\n  -webkit-user-select: none;\n  user-select: none;\n}\n\n.action-card[data-v-f18a87] {\n  --inactive-card-filter: invert(1) brightness(.4) invert(1);\n  left: calc(1px * var(--card-x));\n  top: calc(1px * var(--card-y));\n  position: absolute;\n}\n\n.action-card[data-v-f18a87]:not(.active) {\n  filter: var(--inactive-card-filter);\n}\n\n.action-card .image[data-v-f18a87] {\n  position: relative;\n}\n\n.action-card .label[data-v-f18a87] {\n  text-align: center;\n  place-items: center;\n  width: 100%;\n  height: 100%;\n  font-family: sans-serif;\n  font-size: x-large;\n  display: grid;\n  position: absolute;\n  top: 0;\n  left: 0;\n}\n\n.action-card .highlight[data-v-f18a87] {\n  background: #fff7;\n}\n\n.card-slot[data-v-d849c7] {\n  transform-origin: 0 0;\n  --card-x-px: calc(1px * var(--card-x));\n  --card-y-px: calc(1px * var(--card-y));\n  transform: translateX(var(--card-x-px)) translateY(var(--card-y-px)) rotate(calc(1deg * var(--card-angle)));\n  width: 220px;\n  height: 300px;\n  position: absolute;\n}\n\n.card-slot.dev-mode[data-v-d849c7] {\n  background-color: #ffffff80;\n  outline: 2px dotted gray;\n}\n\n.card-slot > .label[data-v-d849c7] {\n  text-align: center;\n  place-items: center;\n  width: 100%;\n  height: 100%;\n  font-family: sans-serif;\n  font-size: x-large;\n  display: grid;\n  position: absolute;\n  top: 0;\n  left: 0;\n}\n\n.model-visualization[data-v-b9d3e8] {\n  overflow: visible;\n}\n\n.model-visualization .stock[data-v-b9d3e8] {\n  stroke: none;\n  opacity: .75;\n}\n\n.model-visualization .supply[data-v-b9d3e8] {\n  fill: #d3d3d3;\n}\n\n.model-visualization .capacity[data-v-b9d3e8] {\n  fill: gray;\n}\n\n.model-visualization .flow[data-v-b9d3e8] {\n  stroke-linecap: round;\n  stroke-linejoin: round;\n  animation: 100s linear calc(-100s * var(--highlight)) paused highlight-b9d3e8;\n  fill: none;\n  animation-fill-mode: both;\n}\n\n.model-visualization .flow.edge[data-v-b9d3e8] {\n  stroke-width: 8px;\n  display: none;\n}\n\n.model-visualization .flow.anim-edge[data-v-b9d3e8] {\n  stroke-width: 15px;\n  stroke-dasharray: 10 27;\n  --max-dashoffset-step: 15;\n}\n\n.model-visualization .flow#recycle-flow[data-v-b9d3e8], .model-visualization .flow#recycle-edge[data-v-b9d3e8], .model-visualization .flow#produce-from-recycled-materials-flow[data-v-b9d3e8], .model-visualization .flow#produce-from-recycled-materials-edge[data-v-b9d3e8], .model-visualization .flow#repair-flow[data-v-b9d3e8], .model-visualization .flow#repair-edge[data-v-b9d3e8], .model-visualization .flow#acquire-repaired-flow[data-v-b9d3e8], .model-visualization .flow#acquire-repaired-edge[data-v-b9d3e8], .model-visualization .flow#refurbish-flow[data-v-b9d3e8], .model-visualization .flow#refurbish-edge[data-v-b9d3e8], .model-visualization .flow#acquire-refurbished-flow[data-v-b9d3e8], .model-visualization .flow#acquire-refurbished-edge[data-v-b9d3e8], .model-visualization .flow#acquire-used-flow[data-v-b9d3e8], .model-visualization .flow#acquire-used-edge[data-v-b9d3e8] {\n  stroke: gray;\n}\n\n.model-visualization .flow#recycle-flow.anim-edge[data-v-b9d3e8], .model-visualization .flow#recycle-edge.anim-edge[data-v-b9d3e8], .model-visualization .flow#produce-from-recycled-materials-flow.anim-edge[data-v-b9d3e8], .model-visualization .flow#produce-from-recycled-materials-edge.anim-edge[data-v-b9d3e8], .model-visualization .flow#repair-flow.anim-edge[data-v-b9d3e8], .model-visualization .flow#repair-edge.anim-edge[data-v-b9d3e8], .model-visualization .flow#acquire-repaired-flow.anim-edge[data-v-b9d3e8], .model-visualization .flow#acquire-repaired-edge.anim-edge[data-v-b9d3e8], .model-visualization .flow#refurbish-flow.anim-edge[data-v-b9d3e8], .model-visualization .flow#refurbish-edge.anim-edge[data-v-b9d3e8], .model-visualization .flow#acquire-refurbished-flow.anim-edge[data-v-b9d3e8], .model-visualization .flow#acquire-refurbished-edge.anim-edge[data-v-b9d3e8], .model-visualization .flow#acquire-used-flow.anim-edge[data-v-b9d3e8], .model-visualization .flow#acquire-used-edge.anim-edge[data-v-b9d3e8] {\n  stroke-dasharray: 0 27;\n  --max-dashoffset-step: 12.5;\n}\n\n.model-visualization foreignObject[data-v-b9d3e8] {\n  overflow: visible;\n}\n\n.model-visualization .label[data-v-b9d3e8] {\n  text-anchor: middle;\n  dominant-baseline: middle;\n  font-family: sans-serif;\n  font-size: 48px;\n}\n\n.fade-in[data-v-80321f] {\n  opacity: 1;\n  animation: 1s linear forwards fadeIn-80321f;\n}\n\n.fade-out[data-v-80321f] {\n  opacity: 1;\n  animation: 1s linear forwards fadeOut-80321f;\n}\n\n.reset-timeout-panel[data-v-80321f] {\n  background-color: #fffc;\n  flex-direction: column;\n  justify-content: center;\n  gap: 30px;\n  width: 100%;\n  height: 100%;\n  display: flex;\n  position: absolute;\n  top: 0;\n  left: 0;\n}\n\n.title[data-v-80321f] {\n  text-align: center;\n  font-size: 128px;\n}\n\n.description[data-v-80321f] {\n  text-align: center;\n  font-size: 64px;\n}\n\n.countdown[data-v-80321f] {\n  text-align: center;\n  font-size: 256px;\n}\n\n.app-background[data-v-6cf05b] {\n  background-color: #000;\n  width: 100%;\n  height: 100%;\n}\n\n.layer-panel[data-v-6cf05b] {\n  background-color: #fff;\n}\n\n.model-visualization[data-v-6cf05b] {\n  width: calc(1px * var(--svg-width));\n  transform: scale(var(--svg-scale-factor));\n  transform-origin: 0 0;\n}\n\n.slot-panel[data-v-6cf05b], .marker-panel[data-v-6cf05b] {\n  touch-action: none;\n}\n\n.pointer-events-fallthrough[data-v-6cf05b] {\n  pointer-events: none;\n}\n\n.score[data-v-6cf05b], .score-bottom-right[data-v-6cf05b], .score-top-left[data-v-6cf05b] {\n  position: absolute;\n}\n\n.score-top-left[data-v-6cf05b] {\n  transform-origin: center;\n  top: 0;\n  left: 0;\n  transform: rotate(180deg);\n}\n\n.score-bottom-right[data-v-6cf05b] {\n  bottom: 0;\n  right: 0;\n}\n/*# sourceMappingURL=index.4e532d05.css.map */\n","@import \"d718d64a9e189ad7\";\n@import \"e9db3caaf078d42b\";\n@import \"5100861d807143cb\";\n@import \"979de8b543a8b46a\";\n@import \"0e19a8b66b192c49\";\n@import \"a6de3dd6d9112598\";\n@import \"6120a7ed7ff4ece9\";\n@import \"ff49f7e60f0e3a3b\";\n@import \"e13c796f83b78715\";\n@import \"9faa9d21119178cf\";\n@import \"c8364f43a0d6c3b9\";\n@import \"a37a1ea91e5ce77b\";\n@import \"b50c7987d3be007c\";\n@import \"e8f85e180decbdf1\";\n@import \"99d2025a75b4422d\";\n@import \"25533019bdf4d858\";\n@import \"a9b2cdc35cd396f7\";\n@import \"951bdde8bef52012\";\n@import \"cad2cce0dd604c1d\";\n@import \"6b470d7514635d78\";\n@import \"a4e0fbdff145ab70\";\n@import \"4602e0f18243ad46\";\n@import \"3acb44b13c93903d\";\n@import \"63f5a027105c94a5\";\n@import \"ca6ea4bbf6096c9f\";\n@import \"8f3004ae8d75a25e\";\n@import \"8e9119abd0561dfb\";\n@import \"104b6b160633f2d1\";\n@import \"282e0eecaeeb2db3\";\n@import \"34469b62c4744a31\";\n@import \"6fa5b5086499497a\";\n@import \"6014ff0a7f3b728a\";\n@import \"147ccb26f510b60d\";\n@import \"3d0f1a6ce00fdcce\";\n","<script setup lang=\"ts\">\nimport type { ElementOf } from 'ts-essentials';\n\nimport { strict as assert } from 'assert';\nimport { onMounted, ref } from 'vue';\nimport Sortable from 'sortablejs';\n\nimport type { Parameters } from '../../ts/circular-economy-model';\n\nimport { useModelStore } from '../../ts/stores/model';\nimport { useParameterTransformsStore } from '../../ts/stores/parameter-transforms';\nimport {\n  type ParameterTransformState,\n  useParameterTransformId,\n  useSlotGroupsStore,\n} from '../../ts/stores/slot-groups';\n\nconst { transformedParametersExt } = useModelStore();\nconst parameterTransformsStore = useParameterTransformsStore();\nconst { slotGroups, nonInternalSlotGroups, internalSlotGroup } =\n  useSlotGroupsStore();\n\nconst newId = ref('');\nconst newScript = ref('');\n\nfunction select({ id }: ParameterTransformState) {\n  newId.value = id;\n  newScript.value =\n    parameterTransformsStore.parameterTransforms.find((pt) => pt.id === id)\n      ?.script ?? '';\n}\n\nfunction addOrModify(id: string, script: string) {\n  parameterTransformsStore.addOrModify(id, script);\n\n  const internalIndex = internalSlotGroup.parameterTransforms.findIndex(\n    (pt) => pt.id === id,\n  );\n  if (internalIndex === -1) {\n    // The parameter transform is not yet in the internal slot group, so we add it\n    const newParameterTransformState: ParameterTransformState =\n      useParameterTransformId(id);\n    internalSlotGroup.parameterTransforms.push(newParameterTransformState);\n  }\n}\n\nfunction remove(id: string) {\n  const usedNonInternally =\n    nonInternalSlotGroups\n      .flatMap(({ parameterTransforms }) => parameterTransforms)\n      .findIndex((pt) => pt.id === id) !== -1;\n\n  if (usedNonInternally) {\n    alert(\n      'Cannot remove parameter transform that is still used in a non-internal slot group',\n    );\n    return;\n  }\n\n  const nextInternalIndex = () =>\n    internalSlotGroup.parameterTransforms.findIndex((pt) => pt.id === id);\n\n  for (\n    let internalIndex = nextInternalIndex();\n    internalIndex !== -1;\n    internalIndex = nextInternalIndex()\n  ) {\n    internalSlotGroup.parameterTransforms.splice(internalIndex, 1);\n  }\n  parameterTransformsStore.remove(id);\n}\n\nfunction move(from: number, to: number) {\n  parameterTransformsStore.move(from, to);\n}\n\nfunction deactivateAllInternal() {\n  internalSlotGroup.parameterTransforms.forEach((pt) => {\n    // eslint-disable-next-line no-param-reassign\n    pt.active = false;\n  });\n}\n\nconst createTooltip = (\n  slotGroup: ElementOf<typeof slotGroups>,\n  parameterTransformState: ParameterTransformState,\n): string => {\n  const slotGroupIndex = slotGroups.findIndex((sg) => sg === slotGroup);\n  assert(slotGroupIndex !== -1);\n  const slotGroupTransformedParametersExt =\n    transformedParametersExt[slotGroupIndex];\n\n  const parameterTransformIndex = slotGroup.parameterTransforms.findIndex(\n    (pts) => pts === parameterTransformState,\n  );\n  assert(parameterTransformIndex !== -1);\n\n  const step = slotGroupTransformedParametersExt.steps[parameterTransformIndex];\n  const { active, script, diff } = step;\n\n  const pToS = (p: Partial<Parameters>) => JSON.stringify(p, null, 2);\n\n  return active\n    ? `Diff: ${pToS(diff)}\\n\\nScript:\\n${script}`\n    : `Script:\\n${script}`;\n};\n\nconst availableContainer = ref<HTMLDivElement | null>(null);\n\nonMounted(() => {\n  assert(availableContainer.value);\n\n  Sortable.create(availableContainer.value, {\n    onEnd: (event) => {\n      const { newDraggableIndex, oldDraggableIndex } = event;\n      assert(typeof newDraggableIndex !== 'undefined');\n      assert(typeof oldDraggableIndex !== 'undefined');\n      move(oldDraggableIndex, newDraggableIndex);\n    },\n  });\n});\n</script>\n\n<template>\n  <div id=\"parameter-transforms\" class=\"parameter-transforms\">\n    <div>\n      Internal (applied first):\n      <div ref=\"availableContainer\" class=\"available\">\n        <div\n          class=\"parameter-transform\"\n          v-for=\"pt in internalSlotGroup.parameterTransforms\"\n          :key=\"pt.uuid\"\n          :id=\"pt.uuid\"\n          :data-id=\"pt.id\"\n          :title=\"createTooltip(internalSlotGroup, pt)\"\n        >\n          <label class=\"draggable\">\n            <input\n              type=\"checkbox\"\n              :name=\"pt.id\"\n              :value=\"pt.id\"\n              v-model=\"pt.active\"\n            /><span class=\"draggable\">{{ pt.id }}</span></label\n          >\n          <span class=\"edit\" @click=\"select(pt)\">✎</span>\n        </div>\n      </div>\n      <br />\n      <input\n        type=\"button\"\n        value=\"Deactivate active internal transforms\"\n        @click=\"deactivateAllInternal()\"\n      />\n    </div>\n    <div>\n      <div>\n        Id:<br />\n        <input\n          type=\"text\"\n          v-model=\"newId\"\n          name=\"parameter-transform-id\"\n        /><br />\n        Script:<br />\n        <textarea\n          v-model=\"newScript\"\n          rows=\"5\"\n          cols=\"10\"\n          name=\"parameter-transform-script\"\n        ></textarea\n        ><br />\n        <input\n          type=\"button\"\n          value=\"Add/Modify\"\n          @click=\"addOrModify(newId, newScript)\"\n        />\n        <input type=\"button\" value=\"Delete\" @click=\"remove(newId)\" />\n      </div>\n      <div class=\"slot-group-transforms\">\n        <div\n          v-for=\"slotGroup in nonInternalSlotGroups\"\n          :key=\"slotGroup.id\"\n          :data-id=\"slotGroup.id\"\n        >\n          <br />\n          Slot group '{{ slotGroup.id }}':\n          <div class=\"available\">\n            <div\n              v-for=\"pt in slotGroup.parameterTransforms\"\n              :key=\"pt.uuid\"\n              :data-id=\"pt.id\"\n              :title=\"createTooltip(slotGroup, pt)\"\n            >\n              <label>\n                <input\n                  type=\"checkbox\"\n                  :name=\"pt.id\"\n                  :value=\"pt.id\"\n                  v-model=\"pt.active\"\n                  disabled\n                />{{ pt.id }}</label\n              >\n              <span class=\"edit\" @click=\"select(pt)\">✎</span>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  </div>\n</template>\n\n<style lang=\"scss\">\n.parameter-transforms {\n  display: flex;\n  gap: 2em;\n\n  & > *:first-child {\n    flex-grow: 0;\n  }\n\n  & > *:last-child {\n    flex-grow: 3;\n\n    & input[type='text'],\n    & textarea {\n      width: 100%;\n    }\n  }\n\n  & .available {\n    overflow: scroll;\n    max-height: 900px;\n\n    /* Hide scrollbar for Chrome, Safari and Opera */\n    &::-webkit-scrollbar {\n      display: none;\n    }\n\n    -ms-overflow-style: none; /* IE and Edge */\n    scrollbar-width: none; /* Firefox */\n    min-width: 300px;\n    max-width: 300px;\n    min-height: 20px;\n    border: solid 1px;\n\n    & > div {\n      outline: solid 1px;\n      padding: 0.2ex;\n      display: flex;\n      flex-wrap: nowrap;\n\n      & label {\n        flex-grow: 1;\n      }\n\n      & label.draggable {\n        cursor: grab;\n      }\n\n      & > * {\n        white-space: nowrap;\n      }\n\n      & input[type='checkbox'],\n      & .edit {\n        margin-left: 0.5ex;\n        margin-right: 0.5ex;\n      }\n\n      & input[type='checkbox']:not(:disabled),\n      & .edit {\n        cursor: pointer;\n      }\n    }\n  }\n}\n\n.slot-group-transforms {\n  height: 700px;\n  overflow: scroll;\n}\n</style>\n","<script setup lang=\"ts\">\nimport type { ElementOf } from 'ts-essentials';\n\nimport { strict as assert } from 'assert';\nimport kebabCase from 'lodash/kebabCase';\nimport camelCase from 'lodash/camelCase';\nimport { onMounted, ref, computed } from 'vue';\nimport { toReactive } from '@vueuse/core';\nimport { v4 as uuid4 } from 'uuid';\n\nimport type { ModelElementObject } from '../../ts/model';\nimport { type Record, type StockId } from '../../ts/circular-economy-model';\n\nimport { BOARD_WIDTH, BOARD_HEIGHT } from '../../ts/builtin-config';\nimport { useAppStore } from '../../ts/stores/app';\nimport { useModelStore } from '../../ts/stores/model';\nimport { useVisualizationStore } from '../../ts/stores/visualization';\nimport { stockIds } from '../../ts/circular-economy-model';\nimport { loadSvg } from '../../ts/util/load-svg';\nimport { getCircleCenter } from '../../ts/util/geometry/svg';\nimport { guardedQuerySelector } from '../../ts/util/guarded-query-selectors';\nimport { storeToRefs } from 'pinia';\n\nconst svgUrl = new URL('../../svg/model.svg', import.meta.url);\nconst uuid = uuid4();\n\nconst mainFlowIds = [\n  'abandon',\n  'acquireNewlyProduced',\n  'acquireRefurbished',\n  'acquireRepaired',\n  'acquireUsed',\n  'disposeBroken',\n  'disposeHibernating',\n  'goBroken',\n  'landfill',\n  'produceFromNaturalResources',\n  'produceFromRecycledMaterials',\n  'recycle',\n  'refurbish',\n  'repair',\n] as const;\n\nconst mainCapacityIds = [\n  'recycledMaterials',\n  'repairedPhones',\n  'refurbishedPhones',\n  'newlyProducedPhones',\n  'phonesInUse',\n] as const;\n\nconst mainSupplyIds = [\n  'recycledMaterials',\n  'hibernatingPhones',\n  'disposedPhones',\n  'brokenPhones',\n  'repairedPhones',\n  'refurbishedPhones',\n  'newlyProducedPhones',\n] as const;\n\nconst additionalVerbatimSupplyIds = ['phonesInUse'] as const;\n\ntype MainFlowIds = typeof mainFlowIds;\ntype MainFlowId = ElementOf<MainFlowIds>;\n\nconst flowVizSigns: ModelElementObject<MainFlowIds> = {\n  abandon: +1,\n  acquireNewlyProduced: -1,\n  acquireRefurbished: -1,\n  acquireRepaired: -1,\n  acquireUsed: -1,\n  disposeBroken: -1,\n  disposeHibernating: -1,\n  goBroken: -1,\n  landfill: -1,\n  produceFromNaturalResources: -1,\n  produceFromRecycledMaterials: -1,\n  recycle: -1,\n  refurbish: -1,\n  repair: -1,\n} as const;\n\nconst svgPromise = loadSvg(svgUrl);\n\nconst appStore = useAppStore();\n\nconst modelStore = useModelStore();\n\nconst visualizationStore = useVisualizationStore();\nconst { scaleFactors } = storeToRefs(visualizationStore);\n\nconst updateInfo = ref({\n  deltaMs: 0,\n  stepSize: 0,\n  flowVizScale: 1,\n  stockVizScale: 1,\n  record: modelStore.record,\n});\n\ninterface StockDescription {\n  readonly id: string;\n  readonly x: number;\n  readonly y: number;\n  radius: number;\n  highlight: number;\n}\n\ninterface FlowDescription {\n  readonly id: string;\n  readonly svgPath: string;\n  dashOffset: number;\n  highlight: number;\n}\n\nconst useStockToRadius = (stockId: StockId) => {\n  const radius = computed(() => {\n    const { record } = updateInfo.value;\n    const { stocks } = record;\n    const stock = stocks[stockId];\n    const stockVizScale = updateInfo.value.stockVizScale;\n    return Math.sqrt((stock * stockVizScale) / Math.PI);\n  });\n  return { radius };\n};\n\nconst useFlowToDashoffset = (flowId: MainFlowId) => {\n  let lastDashOffset = 0;\n  const dashoffset = computed(() => {\n    const { deltaMs, flowVizScale, record } = updateInfo.value;\n    const { flows } = record;\n    const flow = flows[flowId];\n    const flowVizSign = flowVizSigns[flowId];\n\n    // The dash offset step must not be small compared to the dash gap.\n    // Otherwise, the flow animation may appear to move backwards.\n    const maxStep = 10; // TODO: Make this configurable\n    const dashOffsetStep =\n      flowVizSign * Math.min(deltaMs * flowVizScale * flow, maxStep);\n    const dashOffset =\n      (Number.isNaN(lastDashOffset) ? 0 : lastDashOffset) + dashOffsetStep;\n    lastDashOffset = dashOffset;\n    return dashOffset;\n  });\n  return { dashoffset };\n};\n\nconst useFlowToHighlight = (flowId: MainFlowId) => {\n  let previousFlow = updateInfo.value.record.flows[flowId];\n  const highlight = computed(() => {\n    const { flowVizScale, record, stepSize } = updateInfo.value;\n    const flow = record.flows[flowId];\n    const flowDerivative = (flow - previousFlow) / stepSize;\n    const scaledFlowDerivative =\n      scaleFactors.value.flowHighlight * flowVizScale * flowDerivative;\n\n    // TODO: fine-tune formula\n    const highlight =\n      0.5 *\n      (1 +\n        Math.min(\n          Math.max(\n            Math.sign(scaledFlowDerivative) *\n              Math.sqrt(Math.abs(scaledFlowDerivative)),\n            -1,\n          ),\n          1,\n        ));\n    previousFlow = flow;\n    return appStore.highlightDerivatives && !Number.isNaN(highlight)\n      ? highlight\n      : 0.5;\n  });\n  return { highlight };\n};\n\nconst extractFlowDescriptions = (svgElement: SVGElement): FlowDescription[] =>\n  mainFlowIds.map((id) => {\n    const flowElement = guardedQuerySelector(\n      SVGGeometryElement,\n      `#${kebabCase(id)}`,\n      svgElement,\n    );\n    const svgPath = flowElement.getAttribute('d');\n    assert(svgPath !== null, `SVG path for flow ${id} not found.`);\n    const flowDescription: FlowDescription = toReactive({\n      id,\n      svgPath,\n      dashOffset: useFlowToDashoffset(id).dashoffset,\n      highlight: useFlowToHighlight(id).highlight,\n    });\n    return flowDescription;\n  });\n\nconst extractStockDescriptions = (\n  svgElement: SVGElement,\n  type: 'supply' | 'capacity' | 'verbatim',\n): StockDescription[] => {\n  const mainStockIds =\n    type === 'supply'\n      ? mainSupplyIds\n      : type === 'capacity'\n        ? mainCapacityIds\n        : additionalVerbatimSupplyIds;\n  return mainStockIds.map((mainId) => {\n    const stockElement = guardedQuerySelector(\n      SVGGeometryElement,\n      `#${kebabCase(mainId)}`,\n      svgElement,\n    );\n    assert(stockElement.tagName === 'circle');\n    const { x, y } = getCircleCenter(stockElement as SVGCircleElement);\n    const id = (\n      type === 'verbatim'\n        ? mainId\n        : camelCase(`${type}-of-${kebabCase(mainId)}`)\n    ) as StockId;\n    assert(\n      stockIds.includes(id),\n      `${id} is no valid stockId (${stockIds.join(', ')})`,\n    );\n    const stockDescription: StockDescription = toReactive({\n      id,\n      x,\n      y,\n      radius: useStockToRadius(id).radius,\n      highlight: 0,\n    });\n    return stockDescription;\n  });\n};\n\nconst capacityDescriptions = ref<StockDescription[]>([]);\nconst supplyDescriptions = ref<StockDescription[]>([]);\nconst flowDescriptions = ref<FlowDescription[]>([]);\n\nconst flowElements = ref<SVGPathElement[]>([]);\nconst supplyElements = ref<SVGCircleElement[]>([]);\n\nonMounted(() => {\n  svgPromise.then((svg) => {\n    flowDescriptions.value.push(...extractFlowDescriptions(svg));\n    capacityDescriptions.value.push(\n      ...extractStockDescriptions(svg, 'capacity'),\n    );\n    supplyDescriptions.value.push(\n      ...extractStockDescriptions(svg, 'supply'),\n      ...extractStockDescriptions(svg, 'verbatim'),\n    );\n  });\n});\n\nconst update = (\n  deltaMs: DOMHighResTimeStamp,\n  stepSize: number,\n  record: Record,\n) => {\n  const flowVizScale =\n    scaleFactors.value.flow / record.parameters.numberOfUsers;\n  const stockVizScale =\n    scaleFactors.value.stock / record.parameters.numberOfUsers;\n  updateInfo.value = { deltaMs, stepSize, flowVizScale, stockVizScale, record };\n};\n\ndefineExpose({ update });\n</script>\n\n<template>\n  <div\n    ref=\"container\"\n    class=\"model-viz-container\"\n    :style=\"{\n      '--dev-mode-label-display': appStore.isDeveloperModeActive\n        ? 'inline'\n        : 'none',\n    }\"\n  >\n    <svg\n      :width=\"BOARD_WIDTH\"\n      :height=\"BOARD_HEIGHT\"\n      :viewBox=\"`0 0 ${BOARD_WIDTH} ${BOARD_HEIGHT}`\"\n      xml:space=\"preserve\"\n      xmlns=\"http://www.w3.org/2000/svg\"\n      class=\"model-visualization\"\n    >\n      <path\n        v-for=\"flowDescription in flowDescriptions\"\n        :key=\"flowDescription.id\"\n        :id=\"`${flowDescription.id}-${uuid}`\"\n        ref=\"flowElements\"\n        :data-label=\"flowDescription.id\"\n        :d=\"flowDescription.svgPath\"\n        :stroke-dashoffset=\"flowDescription.dashOffset\"\n        class=\"flow anim-edge\"\n        :style=\"{\n          '--highlight': flowDescription.highlight,\n        }\"\n      />\n      <circle\n        v-for=\"stockDescription in capacityDescriptions\"\n        :key=\"stockDescription.id\"\n        :cx=\"stockDescription.x\"\n        :cy=\"stockDescription.y\"\n        :r=\"stockDescription.radius\"\n        class=\"stock capacity\"\n      />\n      <circle\n        v-for=\"stockDescription in supplyDescriptions\"\n        :key=\"stockDescription.id\"\n        :id=\"`${stockDescription.id}-${uuid}`\"\n        ref=\"supplyElements\"\n        :data-label=\"stockDescription.id\"\n        :cx=\"stockDescription.x\"\n        :cy=\"stockDescription.y\"\n        :r=\"stockDescription.radius\"\n        class=\"stock supply\"\n      />\n      <template v-if=\"appStore.isDeveloperModeActive\">\n        <text v-for=\"flowElement in flowElements\" :key=\"flowElement.id\">\n          <textPath\n            :xlink:href=\"`#${flowElement.id}`\"\n            startOffset=\"50%\"\n            text-anchor=\"middle\"\n            dominant-baseline=\"middle\"\n            class=\"label\"\n          >\n            {{ flowElement.dataset.label }}\n          </textPath>\n        </text>\n        <text\n          v-for=\"supplyElement in supplyElements\"\n          :key=\"supplyElement.id\"\n          :x=\"supplyElement.getAttribute('cx')\"\n          :y=\"supplyElement.getAttribute('cy')\"\n          class=\"label\"\n        >\n          {{ supplyElement.dataset.label }}\n        </text>\n      </template>\n    </svg>\n  </div>\n</template>\n\n<style scoped lang=\"scss\">\n.model-visualization {\n  overflow: visible;\n\n  .stock {\n    stroke: none;\n    opacity: 0.75;\n  }\n\n  .supply {\n    fill: lightgray;\n  }\n\n  .capacity {\n    fill: gray;\n  }\n\n  @keyframes highlight {\n    0% {\n      stroke: red;\n    }\n\n    50% {\n      stroke: gray;\n    }\n\n    100% {\n      stroke: blue;\n    }\n  }\n\n  .flow {\n    stroke-linecap: round;\n    stroke-linejoin: round;\n    animation: 100s linear calc(-100s * var(--highlight)) paused highlight;\n    animation-fill-mode: both;\n\n    fill: none;\n\n    &.edge {\n      stroke-width: 8;\n      display: none;\n    }\n\n    &.anim-edge {\n      stroke-width: 15;\n      stroke-dasharray: 10 27;\n      --max-dashoffset-step: 15; // string must be parseable by parseFloat()\n    }\n\n    &#recycle-flow,\n    &#recycle-edge,\n    &#produce-from-recycled-materials-flow,\n    &#produce-from-recycled-materials-edge,\n    &#repair-flow,\n    &#repair-edge,\n    &#acquire-repaired-flow,\n    &#acquire-repaired-edge,\n    &#refurbish-flow,\n    &#refurbish-edge,\n    &#acquire-refurbished-flow,\n    &#acquire-refurbished-edge,\n    &#acquire-used-flow,\n    &#acquire-used-edge {\n      stroke: gray;\n\n      &.anim-edge {\n        stroke-dasharray: 0 27;\n        --max-dashoffset-step: 12.5; // string must be parseable by parseFloat()\n      }\n    }\n  }\n\n  foreignObject {\n    overflow: visible;\n  }\n\n  .label {\n    font-size: 48px;\n    font-family: sans-serif;\n    text-anchor: middle;\n    dominant-baseline: middle;\n  }\n}\n</style>\n","<script setup lang=\"ts\">\nimport { ref, watch, onMounted, onUnmounted } from 'vue';\nimport { useIntervalFn } from '@vueuse/core';\n\nimport { useConfigStore } from '../../ts/stores/config';\nimport { useModelStore } from '../../ts/stores/model';\nimport { compile } from '../../ts/util/record-condition';\n\ntype Record = ReturnType<typeof useModelStore>['record'];\n\nconst { config, getPrimary, getSecondary } = useConfigStore();\nconst { autoReset: autoResetConfig } = config.general;\nconst modelStore = useModelStore();\n\nconst remainingSeconds = ref(-1);\n\nconst resetCondition = compile(autoResetConfig.condition);\n\nlet unwatch = () => {};\nlet stopCountdown = () => {};\n\nfunction watchModel() {\n  unwatch = watch(modelStore.record, (record) => {\n    if (resetCondition(record)) {\n      unwatch();\n      remainingSeconds.value = Math.round(autoResetConfig.timeoutSeconds);\n      stopCountdown = useIntervalFn(() => {\n        remainingSeconds.value -= 1;\n        switch (remainingSeconds.value) {\n          case 0:\n            modelStore.reset();\n            break;\n          case -1:\n            stopCountdown();\n            watchModel();\n            break;\n        }\n      }).pause;\n    }\n  });\n}\n\nonMounted(watchModel);\n\nonUnmounted(() => {\n  unwatch();\n  stopCountdown();\n  remainingSeconds.value = -1;\n});\n</script>\n\n<template>\n  <div\n    v-if=\"remainingSeconds > -1\"\n    class=\"reset-timeout-panel\"\n    :class=\"{\n      'fade-in': remainingSeconds > 0,\n      'fade-out': remainingSeconds <= 0,\n    }\"\n  >\n    <div class=\"title\">\n      <div class=\"primary-text\">\n        {{ getPrimary(autoResetConfig.title).value }}\n      </div>\n      <div class=\"secondary-text\">\n        {{ getSecondary(autoResetConfig.title).value }}\n      </div>\n    </div>\n    <div class=\"countdown\">{{ Math.max(0, remainingSeconds) }}</div>\n    <div class=\"description\">\n      <div class=\"primary-text\">\n        {{ getPrimary(autoResetConfig.description).value }}\n      </div>\n      <div class=\"secondary-text\">\n        {{ getSecondary(autoResetConfig.description).value }}\n      </div>\n    </div>\n  </div>\n</template>\n\n<style scoped lang=\"scss\">\n@keyframes fadeIn {\n  0% {\n    opacity: 0;\n  }\n  100% {\n    opacity: 1;\n  }\n}\n\n@keyframes fadeOut {\n  0% {\n    opacity: 1;\n  }\n  100% {\n    opacity: 0;\n  }\n}\n\n.fade-in {\n  opacity: 1;\n  animation: fadeIn 1s linear forwards;\n}\n\n.fade-out {\n  opacity: 1;\n  animation: fadeOut 1s linear forwards;\n}\n\n.reset-timeout-panel {\n  position: absolute;\n  top: 0;\n  left: 0;\n  width: 100%;\n  height: 100%;\n  background-color: #fffc;\n  display: flex;\n  flex-direction: column;\n  justify-content: center;\n  gap: 30px;\n}\n\n.title {\n  font-size: 128px;\n  text-align: center;\n}\n\n.description {\n  font-size: 64px;\n  text-align: center;\n}\n\n.countdown {\n  font-size: 256px;\n  text-align: center;\n}\n</style>\n","<script setup lang=\"ts\">\nimport { strict as assert } from 'assert';\nimport { ref, onMounted, onUnmounted } from 'vue';\n\nconst props = defineProps<{ targetSize: { width: number; height: number } }>();\nconst emit = defineEmits<{\n  resize: [scale: number];\n}>();\n\nconst outerElement = ref<HTMLDivElement | null>(null);\nconst innerElement = ref<HTMLDivElement | null>(null);\n\nconst transformInfo = ref({ translateX: 0, translateY: 0, scale: 1 });\n\nonMounted(() => {\n  assert(outerElement.value !== null);\n  const outerElementValue = outerElement.value;\n\n  const handleResize = () => {\n    const rect = outerElementValue.getBoundingClientRect();\n    const scale = Math.min(\n      rect.width / props.targetSize.width,\n      rect.height / props.targetSize.height,\n    );\n    transformInfo.value = {\n      translateX: rect.width / 2,\n      translateY: rect.height / 2,\n      scale,\n    };\n    emit('resize', scale);\n  };\n  const observer = new ResizeObserver(handleResize);\n  observer.observe(outerElementValue);\n  handleResize();\n  onUnmounted(() => observer.disconnect());\n});\n</script>\n\n<template>\n  <div ref=\"outerElement\" class=\"outer\">\n    <div\n      ref=\"innerElement\"\n      class=\"inner\"\n      :style=\"{\n        '--target-width': props.targetSize.width,\n        '--target-height': props.targetSize.height,\n        '--translate-x': transformInfo.translateX,\n        '--translate-y': transformInfo.translateY,\n        '--scale': transformInfo.scale,\n      }\"\n    >\n      <slot></slot>\n    </div>\n  </div>\n</template>\n\n<style scoped lang=\"scss\">\n.outer {\n  position: relative;\n  width: 100%;\n  height: 100%;\n}\n\n.inner {\n  position: absolute;\n  top: 0;\n  left: 0;\n  width: calc(1px * var(--target-width));\n  height: calc(1px * var(--target-height));\n  transform-origin: top left;\n  transform: translateX(calc(1px * var(--translate-x)))\n    translateY(calc(1px * var(--translate-y))) scale(var(--scale))\n    translate(-50%, -50%);\n}\n</style>\n","<script setup lang=\"ts\">\nimport { MARKER_CIRCLE_DIAMETER } from '../../ts/builtin-config';\nimport { useAppStore } from '../../ts/stores/app';\n\nconst appStore = useAppStore();\n\nconst props = defineProps<{\n  readonly markerId: string;\n  x: number;\n  y: number;\n}>();\n</script>\n\n<template>\n  <div\n    class=\"marker\"\n    :style=\"{\n      '--marker-position-x': props.x,\n      '--marker-position-y': props.y,\n      '--marker-diameter': MARKER_CIRCLE_DIAMETER,\n    }\"\n  >\n    <div class=\"circle\"></div>\n    <span v-if=\"appStore.isDeveloperModeActive\">{{ props.markerId }}</span>\n  </div>\n</template>\n\n<style scoped lang=\"scss\">\n.marker {\n  --blur-radius: 15px;\n  --outline-width: 6px;\n  position: absolute;\n  left: calc(1px * var(--marker-position-x));\n  top: calc(1px * var(--marker-position-y));\n  width: calc(1px * var(--marker-diameter));\n  height: calc(1px * var(--marker-diameter));\n  transform-origin: top left;\n  transform: translate(-50%, -50%);\n\n  * {\n    pointer-events: none;\n    user-select: none;\n  }\n\n  display: grid;\n  place-items: center center;\n  font-family: sans-serif;\n  font-size: x-large;\n\n  .circle {\n    position: absolute;\n    width: 100%;\n    height: 100%;\n    border-radius: 50%;\n    background-color: rgb(211 211 211 / 50%);\n    outline: 6px solid rgb(0 0 0 / 75%);\n    filter: blur(var(--blur-radius));\n\n    &.active {\n      background-color: rgb(55 175 218 / 50%);\n    }\n  }\n}\n</style>\n","<script setup lang=\"ts\">\nimport type { ElementOf } from 'ts-essentials';\nimport type { Ref } from 'vue';\n\nimport { computed } from 'vue';\n\nimport { useConfigStore } from '../../ts/stores/config';\nimport { useModelStore } from '../../ts/stores/model';\nimport { Scores } from '../../ts/scores';\n\nconst {\n  config: { general },\n  getPrimary,\n  getSecondary,\n} = useConfigStore();\nconst { description, scoreLabels } = general;\n\nconst modelStore = useModelStore();\n\ninterface ScoreInfo {\n  id: string;\n  score: Ref<number>;\n  primaryLabel: Ref<string>;\n  secondaryLabel: Ref<string>;\n}\n\nconst scoreIds = ['circularity', 'coverage'] as const;\n\nfunction createScoreInfo(id: ElementOf<typeof scoreIds>): ScoreInfo {\n  return {\n    id,\n    score: computed(() => Scores[id](modelStore.record)),\n    primaryLabel: getPrimary(scoreLabels[id]),\n    secondaryLabel: getSecondary(scoreLabels[id]),\n  };\n}\n\nconst scores = scoreIds.map(createScoreInfo);\n\nconst fractionDigits = 1;\nconst nanScoreText = `–.${''.padEnd(fractionDigits, '–')}`;\nconst format = (score: number) => {\n  if (Number.isFinite(score))\n    return `${(score * 100).toFixed(fractionDigits)}%`;\n\n  if (score === Number.POSITIVE_INFINITY) return `∞%`;\n\n  if (score === Number.NEGATIVE_INFINITY) return `−∞%`;\n\n  return `${nanScoreText}%`;\n};\n</script>\n\n<template>\n  <div class=\"scores\">\n    <table class=\"score-table\">\n      <tr>\n        <td colspan=\"2\" class=\"primary-text header\">\n          {{ getPrimary(description).value }}\n        </td>\n      </tr>\n      <template\n        v-for=\"{ id, score, primaryLabel, secondaryLabel } in scores\"\n        :key=\"id\"\n      >\n        <tr>\n          <td class=\"label-column\">\n            <div class=\"primary-text\">{{ primaryLabel.value }}&nbsp;</div>\n            <div class=\"secondary-text\">{{ secondaryLabel.value }}</div>\n          </td>\n          <td class=\"primary-text score-column\">\n            <div class=\"score-value\">{{ format(score.value) }}</div>\n          </td>\n        </tr>\n      </template>\n      <tr>\n        <td colspan=\"2\" class=\"secondary-text footer\">\n          {{ getSecondary(description).value }}\n        </td>\n      </tr>\n    </table>\n  </div>\n</template>\n\n<style lang=\"scss\" scoped>\n.scores {\n  display: table;\n  table-layout: fixed;\n  margin: 44px;\n  width: 395px;\n  height: 395px;\n  background-color: #e10984;\n  border-radius: 50%;\n  color: white;\n  font-size: 20px;\n  line-height: 1.2;\n  text-transform: uppercase;\n  white-space: pre;\n  position: absolute;\n}\n\n.score-table {\n  position: absolute;\n  top: 50%;\n  left: 50%;\n  transform: translate(-50%, -50%);\n}\n\ntable {\n  border-collapse: separate;\n  border-spacing: 1ex 0.5em;\n}\n\n.header {\n  padding-top: 0.5em;\n  padding-bottom: 1em;\n}\n\n.footer {\n  padding-top: 1em;\n}\n\ntr:first-child > td,\ntr:last-child > td {\n  text-align: center;\n}\n\ntd {\n  vertical-align: top;\n}\n\n.score-column {\n  text-align: right;\n}\n\n.score-value {\n  display: inline-block;\n  width: 8ex;\n  text-align: right;\n}\n</style>\n","<script setup lang=\"ts\">\nimport { computed } from 'vue';\n\nimport { useModelStore } from '../../ts/stores/model';\nimport { Model } from '../../ts/model';\nimport { Scores } from '../../ts/scores';\n\nconst props = defineProps({ disabled: Boolean });\n\nconst modelStore = useModelStore();\n\nconst scores = computed(() => Scores.all(modelStore.record));\n\nconst createFormatter = (digits: number) => {\n  const multiplier = 10 ** digits;\n  return (_: string, value: unknown): unknown =>\n    typeof value === 'number'\n      ? Math.round(value * multiplier) / multiplier\n      : value;\n};\n\nconst format2 = createFormatter(2);\nconst format3 = createFormatter(3);\n</script>\n\n<template>\n  <template v-if=\"!props.disabled\">\n    <div class=\"container\">\n      <template v-for=\"elementId in Model.elementIds\">\n        <div class=\"preformatted\">\n          {{\n            `${elementId}: ${JSON.stringify(modelStore.record[elementId], format2, 2)}`\n          }}\n        </div>\n      </template>\n      <div class=\"preformatted\">\n        {{ `scores: ${JSON.stringify(scores, format3, 2)}` }}\n      </div>\n    </div>\n  </template>\n</template>\n\n<style scoped lang=\"scss\">\n.container {\n  display: flex;\n  flex-flow: column wrap;\n  justify-content: flex-start;\n  margin-left: 0px;\n  width: 800px;\n  height: 800px;\n}\n\n.preformatted {\n  width: 30%;\n  font-family: monospace;\n  font-size: x-small;\n  white-space: pre;\n  margin-bottom: 3em;\n}\n</style>\n","<script setup lang=\"ts\">\nimport { ref, toRaw, watch } from 'vue';\nimport yaml from 'js-yaml';\n\nimport type { Config } from '../../ts/config/config-schema';\n\nimport { useParameterTransformsStore } from '../../ts/stores/parameter-transforms';\nimport { useSlotGroupsStore } from '../../ts/stores/slot-groups';\nimport { useConfigStore } from '../../ts/stores/config';\nimport { useModelStore } from '../../ts/stores/model';\nimport { validateConfig } from '../../ts/config/config-schema';\nimport { ConfigLoader } from '../../ts/config/config-loader';\n\nconst { config } = useConfigStore();\n\nconst parameterTransformsStore = useParameterTransformsStore();\nconst { parameterTransforms } = parameterTransformsStore;\nconst { rebuildInternalSlotGroup } = useSlotGroupsStore();\nconst { initialParameters, transformedParametersExt } = useModelStore();\n\nconst OState = {\n  SUCCESS: 0,\n  UNPROCESSED: 1,\n  UNKNOWN: 2,\n  ERROR: 3,\n} as const;\ntype State = (typeof OState)[keyof typeof OState];\n\nconst stateTooltips = {\n  [OState.SUCCESS]: 'Successfully imported.',\n  [OState.UNPROCESSED]: '',\n  [OState.UNKNOWN]: 'Unknown import state. Please check the developer console.',\n  [OState.ERROR]: 'Failed to import. Please check the developer console.',\n} as const;\n\nconst parameterTransformsYamlText = ref('');\nconst parameterTransformImportState = ref<State>(OState.UNPROCESSED);\nconst initialParametersYamlText = ref('');\nconst initialParametersImportState = ref<State>(OState.UNPROCESSED);\n\nfunction deriveConfig(partialConfigText: string): Config | null {\n  try {\n    const unvalidatedPartialConfig = (yaml.load(partialConfigText) ??\n      {}) as object;\n    const newConfig = ConfigLoader.merge(\n      structuredClone(toRaw(config)),\n      unvalidatedPartialConfig,\n    );\n    const validationResult = validateConfig(newConfig);\n\n    if (!validationResult.ok) {\n      /* eslint-disable no-console */\n      const {\n        error: { errors, explanation },\n      } = validationResult;\n      console.error('Invalid configuration:', newConfig);\n      console.error(explanation);\n      console.error(\n        'Issues reported by the configuration validator:',\n        ...(errors ?? []),\n      );\n      return null;\n    }\n\n    return validationResult.data;\n  } catch (error) {\n    console.error('Failed to parse YAML:', error);\n    return null;\n  }\n}\n\nasync function importInitialParameters() {\n  const newConfig = deriveConfig(initialParametersYamlText.value);\n  initialParametersImportState.value =\n    newConfig === null ? OState.ERROR : OState.UNKNOWN;\n  if (!newConfig) return;\n\n  const {\n    model: { initialParameters: validatedInitialParameters },\n  } = newConfig;\n\n  Object.assign(initialParameters, validatedInitialParameters);\n\n  initialParametersImportState.value = OState.SUCCESS;\n}\n\nasync function importParameterTransforms() {\n  const newConfig = deriveConfig(parameterTransformsYamlText.value);\n  parameterTransformImportState.value =\n    newConfig === null ? OState.ERROR : OState.UNKNOWN;\n  if (!newConfig) return;\n\n  const { parameterTransforms: validatedParameterTransforms } = newConfig;\n\n  const transformParametersPromise = new Promise((resolve, reject) => {\n    watch(transformedParametersExt, resolve, { deep: true, once: true });\n  });\n\n  parameterTransformsStore.replaceAll(validatedParameterTransforms);\n  rebuildInternalSlotGroup();\n\n  await transformParametersPromise;\n  parameterTransformImportState.value = OState.SUCCESS;\n}\n\nfunction exportInitialParameters() {\n  initialParametersImportState.value = OState.UNPROCESSED;\n  const exportObj = {\n    model: { initialParameters: initialParameters },\n  };\n  initialParametersYamlText.value = yaml.dump(exportObj);\n  console.log(initialParametersYamlText.value);\n}\n\nfunction exportParameterTransforms() {\n  parameterTransformImportState.value = OState.UNPROCESSED;\n  const exportObj = {\n    parameterTransforms: parameterTransforms.map(({ id, script }) => ({\n      id,\n      script,\n    })),\n  };\n  parameterTransformsYamlText.value = yaml.dump(exportObj);\n  console.log(parameterTransformsYamlText.value);\n}\n</script>\n\n<template>\n  Initial parameters:<br />\n  <textarea\n    name=\"initialParametersYamlText\"\n    v-model=\"initialParametersYamlText\"\n    rows=\"15\"\n    cols=\"80\"\n    :class=\"{\n      success: initialParametersImportState === OState.SUCCESS,\n      error: initialParametersImportState === OState.ERROR,\n    }\"\n    :title=\"stateTooltips[initialParametersImportState]\"\n    @input=\"initialParametersImportState = OState.UNPROCESSED\"\n  ></textarea>\n  <div>\n    <input type=\"button\" value=\"Import\" @click=\"importInitialParameters()\" />\n    <input type=\"button\" value=\"Export\" @click=\"exportInitialParameters()\" />\n  </div>\n  <br />\n  Parameter transforms:<br />\n  <textarea\n    name=\"parameterTransformYamlText\"\n    v-model=\"parameterTransformsYamlText\"\n    rows=\"15\"\n    cols=\"80\"\n    :class=\"{\n      success: parameterTransformImportState === OState.SUCCESS,\n      unknown: parameterTransformImportState === OState.UNKNOWN,\n      error: parameterTransformImportState === OState.ERROR,\n    }\"\n    :title=\"stateTooltips[parameterTransformImportState]\"\n    @input=\"parameterTransformImportState = OState.UNPROCESSED\"\n  ></textarea>\n  <div>\n    <input type=\"button\" value=\"Import\" @click=\"importParameterTransforms()\" />\n    <input type=\"button\" value=\"Export\" @click=\"exportParameterTransforms()\" />\n  </div>\n</template>\n\n<style lang=\"scss\" scoped>\n.success {\n  background-color: lightgreen;\n}\n\n.unknown {\n  background-color: lightyellow;\n}\n\n.error {\n  background-color: lightcoral;\n}\n</style>\n","<script setup lang=\"ts\">\nimport { v4 as uuidv4 } from 'uuid';\n\nimport type { ScaleFactors } from '../../ts/stores/visualization';\n\nimport { HOTKEYS } from '../../ts/builtin-config';\nimport { useAppStore } from '../../ts/stores/app';\nimport { useModelStore } from '../../ts/stores/model';\nimport { useVisualizationStore } from '../../ts/stores/visualization';\n\nconst uuid = uuidv4();\n\nconst togglePlayingBtnId = `btn-toggle-playing-${uuid}`;\nconst toggleFullscreenBtnId = `btn-toggle-fullscreen-${uuid}`;\nconst toggleDeveloperModeBtnId = `btn-toggle-dev-mode-${uuid}`;\nconst toggleHighlightDerivativesBtnId = `btn-toggle-highlight-derivatives-${uuid}`;\nconst toggleMarkerSlotLabelsBtnId = `btn-toggle-marker-slot-labels-${uuid}`;\nconst toggleAutoResetBtnId = `btn-toggle-auto-reset-${uuid}`;\n\nconst appStore = useAppStore();\nconst modelStore = useModelStore();\nconst visualizationStore = useVisualizationStore();\n\nconst togglePlaying = () => appStore.$patch({ isPlaying: !appStore.isPlaying });\n\nconst toggleFullscreen = () =>\n  appStore.$patch({ isFullscreen: !appStore.isFullscreen });\n\nconst toggleDeveloperMode = () =>\n  appStore.$patch({ isDeveloperModeActive: !appStore.isDeveloperModeActive });\n\nconst toggleHighlightDerivatives = () =>\n  appStore.$patch({\n    highlightDerivatives: !appStore.highlightDerivatives,\n  });\n\nconst toggleMarkerSlotLabels = () =>\n  appStore.$patch({\n    showMarkerSlotLabels: !appStore.showMarkerSlotLabels,\n  });\n\nconst resetModel = () => modelStore.reset();\n\nconst toggleAutoReset = () => {\n  appStore.$patch({ autoReset: !appStore.autoReset });\n};\n\nconst scaleFactorKeys = Object.keys(\n  visualizationStore.scaleFactors,\n) as (keyof ScaleFactors)[];\n</script>\n\n<template>\n  <input\n    type=\"checkbox\"\n    class=\"btn-check\"\n    :id=\"togglePlayingBtnId\"\n    :class=\"() => (appStore.isFullscreen ? 'active' : '')\"\n    autocomplete=\"off\"\n    @click=\"togglePlaying\"\n  />\n  <label class=\"btn btn-primary\" :for=\"togglePlayingBtnId\"\n    >Run ({{ HOTKEYS.run.label }})</label\n  ><br />\n  <input\n    type=\"checkbox\"\n    class=\"btn-check\"\n    :id=\"toggleFullscreenBtnId\"\n    :class=\"() => (appStore.isFullscreen ? 'active' : '')\"\n    autocomplete=\"off\"\n  />\n  <label\n    class=\"btn btn-primary\"\n    :for=\"toggleFullscreenBtnId\"\n    @click=\"toggleFullscreen\"\n    >Fullscreen ({{ HOTKEYS.fullscreen.label }})</label\n  ><br />\n  <input\n    type=\"checkbox\"\n    class=\"btn-check\"\n    :id=\"toggleDeveloperModeBtnId\"\n    :class=\"() => (appStore.isDeveloperModeActive ? 'active' : '')\"\n    autocomplete=\"off\"\n  />\n  <label\n    class=\"btn btn-primary\"\n    :for=\"toggleDeveloperModeBtnId\"\n    @click=\"toggleDeveloperMode\"\n    >Developer mode ({{ HOTKEYS.developerMode.label }})</label\n  ><br />\n  <input\n    type=\"checkbox\"\n    class=\"btn-check\"\n    :id=\"toggleHighlightDerivativesBtnId\"\n    :class=\"() => (appStore.highlightDerivatives ? 'active' : '')\"\n    autocomplete=\"off\"\n  />\n  <label\n    class=\"btn btn-primary\"\n    :for=\"toggleHighlightDerivativesBtnId\"\n    @click=\"toggleHighlightDerivatives\"\n    >Highlight derivatives ({{ HOTKEYS.highlightDerivatives.label }})</label\n  ><br />\n  <input\n    type=\"checkbox\"\n    class=\"btn-check\"\n    :id=\"toggleMarkerSlotLabelsBtnId\"\n    :class=\"() => (appStore.showMarkerSlotLabels ? 'active' : '')\"\n    autocomplete=\"off\"\n  />\n  <label\n    class=\"btn btn-primary\"\n    :for=\"toggleMarkerSlotLabelsBtnId\"\n    @click=\"toggleMarkerSlotLabels\"\n    >Show marker slot labels</label\n  ><br />\n  <button type=\"button\" class=\"btn btn-primary\" @click=\"resetModel\">\n    Reset model ({{ HOTKEYS.reset.label }})</button\n  ><br />\n  <input\n    type=\"checkbox\"\n    class=\"btn-check\"\n    :id=\"toggleAutoResetBtnId\"\n    :class=\"() => (appStore.autoReset ? 'active' : '')\"\n    autocomplete=\"off\"\n  />\n  <label\n    class=\"btn btn-primary\"\n    :for=\"toggleAutoResetBtnId\"\n    @click=\"toggleAutoReset\"\n    >Enable auto-reset</label\n  >\n  <br />\n  <form class=\"scale-factors\">\n    <template v-for=\"key in scaleFactorKeys\" :key=\"key\">\n      <p>\n        <label :for=\"`viz-scale-factors-${key}-${uuid}`\">{{ key }}:</label>\n        <input\n          type=\"number\"\n          :id=\"`viz-scale-factors-${key}-${uuid}`\"\n          v-model=\"visualizationStore.scaleFactors[key]\"\n        />\n      </p>\n    </template>\n  </form>\n</template>\n\n<style scoped lang=\"scss\">\n.btn,\n.btn-check {\n  margin-bottom: 0.5rem;\n}\n\n.scale-factors {\n  display: table;\n\n  & > p {\n    display: table-row;\n    & > label {\n      display: table-cell;\n    }\n    & > input {\n      display: table-cell;\n    }\n  }\n}\n</style>\n","<script setup lang=\"ts\">\nimport { ref } from 'vue';\n\nimport ControlPanelTabInitialParameters from './ControlPanelTabInitialParameters.vue';\nimport ControlPanelTabParameterTransforms from './ControlPanelTabParameterTransforms.vue';\nimport ControlPanelTabCharts from './ControlPanelTabCharts.vue';\nimport ControlPanelTabRawData from './ControlPanelTabRawData.vue';\nimport ControlPanelTabImportExport from './ControlPanelTabImportExport.vue';\nimport ControlPanelTabMisc from './ControlPanelTabMisc.vue';\n\nconst props = defineProps({ disabled: Boolean });\n\nconst diagramsTabDisabled = ref(true);\nconst rawDataTabDisabled = ref(true);\n</script>\n\n<template>\n  <div :class=\"{ hidden: props.disabled }\">\n    <div class=\"control-panel\">\n      <nav>\n        <div class=\"nav nav-tabs\" id=\"nav-tab\" role=\"tablist\">\n          <button\n            class=\"nav-link\"\n            id=\"nav-initial-parameters-tab\"\n            data-bs-toggle=\"tab\"\n            data-bs-target=\"#nav-initial-parameters\"\n            type=\"button\"\n            role=\"tab\"\n            aria-controls=\"nav-initial-parameters\"\n            aria-selected=\"false\"\n          >\n            Initial parameters\n          </button>\n          <button\n            class=\"nav-link active\"\n            id=\"nav-parameter-transforms-tab\"\n            data-bs-toggle=\"tab\"\n            data-bs-target=\"#nav-parameter-transforms\"\n            type=\"button\"\n            role=\"tab\"\n            aria-controls=\"nav-parameter-transforms\"\n            aria-selected=\"true\"\n          >\n            Parameter transforms\n          </button>\n          <button\n            class=\"nav-link\"\n            id=\"nav-diagrams-tab\"\n            data-bs-toggle=\"tab\"\n            data-bs-target=\"#nav-diagrams\"\n            type=\"button\"\n            role=\"tab\"\n            aria-controls=\"nav-diagrams\"\n            aria-selected=\"false\"\n            v-on=\"{\n              'hidden.bs.tab': () => (diagramsTabDisabled = true),\n              'show.bs.tab': () => (diagramsTabDisabled = false),\n            }\"\n          >\n            Diagrams\n          </button>\n          <button\n            class=\"nav-link\"\n            id=\"nav-raw-data-tab\"\n            data-bs-toggle=\"tab\"\n            data-bs-target=\"#nav-raw-data\"\n            type=\"button\"\n            role=\"tab\"\n            aria-controls=\"nav-raw-data\"\n            aria-selected=\"false\"\n            v-on=\"{\n              'hidden.bs.tab': () => (rawDataTabDisabled = true),\n              'show.bs.tab': () => (rawDataTabDisabled = false),\n            }\"\n          >\n            Raw data\n          </button>\n          <button\n            class=\"nav-link\"\n            id=\"nav-import-export-tab\"\n            data-bs-toggle=\"tab\"\n            data-bs-target=\"#nav-import-export\"\n            type=\"button\"\n            role=\"tab\"\n            aria-controls=\"nav-import-export\"\n            aria-selected=\"false\"\n          >\n            Import/Export\n          </button>\n          <button\n            class=\"nav-link\"\n            id=\"nav-misc-tab\"\n            data-bs-toggle=\"tab\"\n            data-bs-target=\"#nav-misc\"\n            type=\"button\"\n            role=\"tab\"\n            aria-controls=\"nav-misc\"\n            aria-selected=\"true\"\n          >\n            Misc\n          </button>\n        </div>\n      </nav>\n      <div class=\"tab-content\" id=\"nav-tabContent\">\n        <div\n          class=\"tab-pane show\"\n          id=\"nav-initial-parameters\"\n          role=\"tabpanel\"\n          aria-labelledby=\"nav-initial-parameters-tab\"\n          tabindex=\"0\"\n        >\n          <ControlPanelTabInitialParameters />\n        </div>\n        <div\n          class=\"tab-pane show active\"\n          id=\"nav-parameter-transforms\"\n          role=\"tabpanel\"\n          aria-labelledby=\"nav-parameter-transforms-tab\"\n          tabindex=\"0\"\n        >\n          <ControlPanelTabParameterTransforms />\n        </div>\n        <div\n          class=\"tab-pane show\"\n          id=\"nav-diagrams\"\n          role=\"tabpanel\"\n          aria-labelledby=\"nav-diagrams-tab\"\n          tabindex=\"0\"\n        >\n          <ControlPanelTabCharts\n            :disabled=\"props.disabled || diagramsTabDisabled\"\n          />\n        </div>\n        <div\n          class=\"tab-pane show\"\n          id=\"nav-raw-data\"\n          role=\"tabpanel\"\n          aria-labelledby=\"nav-raw-data-tab\"\n          tabindex=\"0\"\n        >\n          <ControlPanelTabRawData\n            :disabled=\"props.disabled || rawDataTabDisabled\"\n          />\n        </div>\n        <div\n          class=\"tab-pane show\"\n          id=\"nav-import-export\"\n          role=\"tabpanel\"\n          aria-labelledby=\"nav-import-export-tab\"\n          tabindex=\"0\"\n        >\n          <ControlPanelTabImportExport />\n        </div>\n        <div\n          class=\"tab-pane show\"\n          id=\"nav-misc\"\n          role=\"tabpanel\"\n          aria-labelledby=\"nav-misc-tab\"\n          tabindex=\"0\"\n        >\n          <ControlPanelTabMisc />\n        </div>\n      </div>\n    </div>\n  </div>\n</template>\n\n<style lang=\"scss\" scoped>\n.control-panel {\n  // this node is designed for 1920x1080 and than scaled up 2x\n  position: absolute;\n  top: 0;\n  right: 0;\n  width: calc(1px * var(--app-width) / 4);\n  height: 50%;\n  box-sizing: border-box;\n  border-left: solid 1px;\n  background-color: white;\n  transform-origin: top right;\n  transform: scale(2);\n  display: flex;\n  flex-direction: column;\n\n  & nav {\n    padding-top: 1ex;\n\n    & button[disabled] {\n      text-decoration: line-through;\n    }\n  }\n\n  & .tab-pane {\n    padding: 1em;\n  }\n\n  & .tab-content {\n    flex-grow: 2;\n    overflow: scroll;\n  }\n}\n</style>\n","<script setup lang=\"ts\">\nimport type { DeepReadonly } from 'ts-essentials';\nimport type { Ref } from 'vue';\n\nimport { computed } from 'vue';\n\nimport type { ConditionalLayerConfig } from '../../ts/config/config-schema-types';\nimport type { Condition } from '../../ts/util/record-condition';\n\nimport { useConfigStore } from '../../ts/stores/config';\nimport { useModelStore } from '../../ts/stores/model';\nimport { compile } from '../../ts/util/record-condition';\n\nconst props = defineProps<{\n  readonly layerConfig: DeepReadonly<ConditionalLayerConfig>;\n}>();\n\nconst { extractAssetPosition, toAssetUrl } = useConfigStore();\nconst modelStore = useModelStore();\n\nfunction compileLayer({ condition, url }: ConditionalLayerConfig): {\n  checkCondition: Condition<typeof modelStore.record>;\n  condition: string;\n  active: Ref<boolean>;\n  url: URL;\n  x: number;\n  y: number;\n} {\n  const resolvedUrl = toAssetUrl(url);\n  const { x, y } = extractAssetPosition(resolvedUrl);\n  const checkCondition = compile(condition);\n  const active = computed(() => checkCondition(modelStore.record));\n  return {\n    checkCondition,\n    condition,\n    active,\n    url: resolvedUrl,\n    x,\n    y,\n  };\n}\n\nconst compiledLayer = compileLayer(props.layerConfig);\n</script>\n\n<template>\n  <img\n    :src=\"compiledLayer.url.href\"\n    class=\"positioned-layer\"\n    :class=\"{ inactive: !compiledLayer.active.value }\"\n    :style=\"{\n      '--layer-x': compiledLayer.x,\n      '--layer-y': compiledLayer.y,\n    }\"\n    :alt=\"`${compiledLayer.condition} -> ${compiledLayer.url}`\"\n  />\n</template>\n\n<style scoped lang=\"scss\">\n.positioned-layer {\n  position: absolute;\n  top: calc(1px * var(--layer-y));\n  left: calc(1px * var(--layer-x));\n}\n\n.inactive {\n  display: none;\n}\n</style>\n","<script setup lang=\"ts\">\nimport type { DeepReadonly, Writable } from 'ts-essentials';\n\nimport { difference } from 'lodash';\nimport { ref, computed, watchEffect, watch } from 'vue';\nimport { useArrayFilter } from '@vueuse/core';\n\nimport type { Marker } from '../../ts/stores/marker';\nimport type { SlotConfig } from '../../ts/config/config-schema';\n\nimport { SLOT_CIRCLE_DIAMETER } from '../../ts/builtin-config';\nimport { useConfigStore } from '../../ts/stores/config';\nimport { useAppStore } from '../../ts/stores/app';\nimport { useMarkerStore } from '../../ts/stores/marker';\nimport { useSlotStore } from '../../ts/stores/slot';\n\nimport { Circle } from '../../ts/util/geometry/circle';\n\nconst props = defineProps<{\n  readonly slotGroupId: string;\n  readonly primaryLabel: string;\n  readonly secondaryLabel: string;\n  readonly activeUrl: string;\n  readonly inactiveUrl: string;\n  readonly slotConfig: DeepReadonly<SlotConfig>;\n}>();\n\nconst { slotConfig } = props;\n\nconst slotGroupId = ref(props.slotGroupId);\nconst slotId = `${slotGroupId.value}-${slotConfig.id}`;\n\nconst { toAssetUrl, extractAssetPosition } = useConfigStore();\nconst markerSlotActiveUrl = toAssetUrl(props.activeUrl);\nconst markerSlotInactiveUrl = toAssetUrl(props.inactiveUrl);\nconst markerSlotActivePosition = extractAssetPosition(markerSlotActiveUrl);\nconst markerSlotInactivePosition = extractAssetPosition(markerSlotInactiveUrl);\n\nconst appStore = useAppStore();\n\nconst markerStore = useMarkerStore();\nconst { markerPositions } = markerStore;\n\nconst slotStore = useSlotStore();\n\nconst slotCircle = new Circle(\n  slotConfig.x,\n  slotConfig.y,\n  SLOT_CIRCLE_DIAMETER / 2,\n);\n\nlet previousContainedMarkers = new Array<Marker>();\n\nconst containedMarkers = useArrayFilter(\n  markerPositions as Writable<typeof markerPositions>,\n  (m) => slotCircle.containsPoint(m),\n);\n\nwatchEffect(() => {\n  const added = difference(containedMarkers.value, previousContainedMarkers);\n  const removed = difference(previousContainedMarkers, containedMarkers.value);\n  removed.forEach(({ id: markerId }) =>\n    slotStore.addActivation({ slotId, markerId }),\n  );\n  added.forEach(({ id: markerId }) =>\n    slotStore.addActivation({ slotId, markerId }),\n  );\n  previousContainedMarkers = containedMarkers.value;\n});\n\nconst isActive = computed(() => containedMarkers.value.length > 0);\n\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\nconst emit = defineEmits<{\n  activate: [ids: { slotId: string; slotGroupId: string }];\n  deactivate: [ids: { slotId: string; slotGroupId: string }];\n}>();\n\nwatch(\n  () => isActive.value,\n  (isActiveNow, isActivePrev) => {\n    if (isActiveNow && !isActivePrev) {\n      emit('activate', { slotId, slotGroupId: slotGroupId.value });\n    } else {\n      emit('deactivate', { slotId, slotGroupId: slotGroupId.value });\n    }\n  },\n);\n</script>\n\n<template>\n  <div\n    :data-slot-id=\"slotConfig.id\"\n    class=\"slot\"\n    :style=\"{\n      '--slot-x': slotConfig.x,\n      '--slot-y': slotConfig.y,\n      '--slot-angle': `${slotConfig.angle}deg`,\n      '--slot-diameter': SLOT_CIRCLE_DIAMETER,\n    }\"\n  >\n    <div class=\"asset-container\">\n      <img\n        v-show=\"isActive\"\n        :src=\"markerSlotActiveUrl.href\"\n        :alt=\"`${slotConfig.id}-active`\"\n        :style=\"{\n          '--asset-x': markerSlotActivePosition.x,\n          '--asset-y': markerSlotActivePosition.y,\n        }\"\n      />\n      <img\n        v-show=\"!isActive\"\n        :src=\"markerSlotInactiveUrl.href\"\n        :alt=\"`${slotConfig.id}-inactive`\"\n        :style=\"{\n          '--asset-x': markerSlotInactivePosition.x,\n          '--asset-y': markerSlotInactivePosition.y,\n        }\"\n      />\n    </div>\n    <div\n      v-if=\"appStore.isDeveloperModeActive\"\n      class=\"circle\"\n      :class=\"{ active: isActive, inactive: !isActive }\"\n    ></div>\n    <div v-if=\"appStore.showMarkerSlotLabels\" class=\"label\">\n      <div class=\"primary-text\">{{ props.primaryLabel }}</div>\n      <div class=\"secondary-text\">{{ props.secondaryLabel }}</div>\n    </div>\n    <div v-if=\"appStore.isDeveloperModeActive\" class=\"dev-label\">\n      {{ slotGroupId }}<br />{{ slotConfig.id }}\n    </div>\n  </div>\n</template>\n\n<style scoped lang=\"scss\">\n.slot {\n  left: calc(1px * var(--slot-x));\n  top: calc(1px * var(--slot-y));\n  width: calc(1px * var(--slot-diameter));\n  height: calc(1px * var(--slot-diameter));\n  position: absolute;\n  transform-origin: center;\n  transform: translate(-50%, -50%) rotate(var(--slot-angle));\n\n  & > .asset-container {\n    position: absolute;\n    transform: translate(0%, 50%);\n    top: 0;\n    left: 0;\n    width: 100%;\n    height: 100%;\n\n    & > img {\n      position: absolute;\n      transform: translateX(calc(1px * var(--asset-x)))\n        translateY(calc(1px * var(--asset-y)));\n    }\n  }\n\n  & > .circle {\n    position: absolute;\n    left: 0;\n    top: 0;\n    width: 100%;\n    height: 100%;\n    border-radius: 50%;\n    box-sizing: content-box;\n    outline: solid 2px;\n\n    &.inactive {\n      outline-color: darkgray;\n    }\n\n    &.active {\n      outline-color: black;\n    }\n  }\n\n  & .label {\n    position: absolute;\n    text-align: left;\n    text-transform: uppercase;\n    white-space: pre-line;\n    font-size: 20px;\n    color: black;\n  }\n\n  & .dev-label {\n    position: absolute;\n    background-color: #fffa;\n  }\n\n  * {\n    pointer-events: none;\n    user-select: none;\n  }\n\n  display: grid;\n  place-items: center center;\n  font-family: sans-serif;\n  font-size: x-large;\n  text-align: center;\n}\n</style>\n","<script setup lang=\"ts\">\nimport { computed } from 'vue';\n\nimport { useConfigStore } from '../../ts/stores/config';\nimport { useAppStore } from '../../ts/stores/app';\n\nconst props = defineProps<{\n  readonly url: string;\n  readonly label: string;\n  active: boolean;\n}>();\n\nconst { toAssetUrl, extractAssetPosition } = useConfigStore();\nconst appStore = useAppStore();\n\nconst assetUrl = computed(() => toAssetUrl(props.url));\n\n// const position = computed(() => extractAssetPosition(assetUrl.value));\n// Keep the position fixed for now\nconst position = { x: 0, y: 0 };\n</script>\n\n<template>\n  <div\n    class=\"action-card\"\n    :class=\"{ active: props.active }\"\n    :style=\"{\n      '--card-x': position.x,\n      '--card-y': position.y,\n    }\"\n  >\n    <img :src=\"assetUrl.href\" :alt=\"label\" class=\"image\" />\n    <div class=\"label\" v-if=\"appStore.isDeveloperModeActive\">\n      <span class=\"highlight\">{{ label }}</span>\n    </div>\n  </div>\n</template>\n\n<style scoped lang=\"scss\">\n.action-card {\n  --inactive-card-filter: invert(1) brightness(0.4) invert(1);\n  position: absolute;\n  left: calc(1px * var(--card-x));\n  top: calc(1px * var(--card-y));\n\n  &:not(.active) {\n    filter: var(--inactive-card-filter);\n  }\n\n  .image {\n    position: relative;\n  }\n\n  .label {\n    position: absolute;\n    top: 0;\n    left: 0;\n    width: 100%;\n    height: 100%;\n    display: grid;\n    place-items: center center;\n    font-family: sans-serif;\n    font-size: x-large;\n    text-align: center;\n  }\n\n  .highlight {\n    background: #fff7;\n  }\n}\n</style>\n","<script setup lang=\"ts\">\nimport type { DeepReadonly } from 'ts-essentials';\n\nimport type { CardSlotConfig, CardConfig } from '../../ts/config/config-schema';\n\nimport { useAppStore } from '../../ts/stores/app';\n\nimport GameCard from './GameCard.vue';\n\nconst props = defineProps<{\n  readonly cardSlotConfig: DeepReadonly<CardSlotConfig>;\n  cardConfig: DeepReadonly<CardConfig> | null;\n  active: boolean;\n}>();\n\nconst appStore = useAppStore();\n</script>\n\n<template>\n  <div\n    :style=\"{\n      '--card-x': cardSlotConfig.x,\n      '--card-y': cardSlotConfig.y,\n      '--card-angle': cardSlotConfig.angle,\n    }\"\n    class=\"card-slot\"\n    :class=\"{ 'dev-mode': appStore.isDeveloperModeActive }\"\n  >\n    <div class=\"label\" v-if=\"appStore.isDeveloperModeActive\">\n      {{ cardSlotConfig.id }}\n    </div>\n    <template v-if=\"cardConfig !== null\">\n      <GameCard\n        :url=\"cardConfig.url\"\n        :label=\"cardConfig.parameterTransformId\"\n        :active=\"props.active\"\n      />\n    </template>\n  </div>\n</template>\n\n<style scoped lang=\"scss\">\n.card-slot {\n  position: absolute;\n  width: 220px;\n  height: 300px;\n  transform-origin: top left;\n  --card-x-px: calc(1px * var(--card-x));\n  --card-y-px: calc(1px * var(--card-y));\n  transform: translateX(var(--card-x-px)) translateY(var(--card-y-px))\n    rotate(calc(1deg * var(--card-angle)));\n\n  &.dev-mode {\n    background-color: rgba(255, 255, 255, 0.5);\n    outline: 2px dotted gray;\n  }\n\n  & > .label {\n    position: absolute;\n    top: 0;\n    left: 0;\n    width: 100%;\n    height: 100%;\n    display: grid;\n    place-items: center center;\n    font-family: sans-serif;\n    font-size: x-large;\n    text-align: center;\n  }\n}\n</style>\n","<script setup lang=\"ts\">\nimport { ref, watch, watchEffect, onMounted } from 'vue';\nimport { onKeyStroke } from '@vueuse/core';\n\nimport ScaledLetterBox from './ScaledLetterbox.vue';\nimport PointerMarkerPanel from './PointerMarkerPanel.vue';\nimport TuioMarkerPanel from './TuioMarkerPanel.vue';\nimport ScoreTable from './ScoreTable.vue';\nimport ControlPanel from './ControlPanel.vue';\nimport ConditionalLayer from './ConditionalLayer.vue';\nimport BasicSlotGroup from './BasicSlotGroup.vue';\nimport ActionCardSlotGroup from './ActionCardSlotGroup.vue';\nimport EventCardSlotGroup from './EventCardSlotGroup.vue';\nimport ModelVisualization from './ModelVisualization.vue';\nimport ResetTimeoutOverlay from './ResetTimeoutOverlay.vue';\n\nimport { HOTKEYS, BOARD_WIDTH, BOARD_HEIGHT } from '../../ts/builtin-config';\nimport { useOptionStore } from '../../ts/stores/options';\nimport { useConfigStore } from '../../ts/stores/config';\nimport { useAppStore } from '../../ts/stores/app';\nimport { useModelStore } from '../../ts/stores/model';\nimport { ignorePromise } from '../../ts/util/ignore-promise';\nimport { ModelSimulator } from '../../ts/model-simulator';\nimport {\n  CircularEconomyModel,\n  type FlowIds,\n  type ParameterIds,\n  type StockIds,\n  type VariableIds,\n} from '../../ts/circular-economy-model';\nimport { Runner } from '../../ts/util/runner';\n\nconst options = useOptionStore();\nconst { config } = useConfigStore();\nconst appStore = useAppStore();\nconst modelStore = useModelStore();\n\nconst model = new CircularEconomyModel();\nconst modelSimulator = new ModelSimulator<\n  StockIds,\n  FlowIds,\n  VariableIds,\n  ParameterIds\n>(\n  model,\n  { ...config.model.initialStocks },\n  { ...config.model.initialParameters },\n  0.0,\n  config.simulation.deltaPerSecond,\n  config.simulation.maxStepSize,\n);\n\nconst runner = new Runner();\n\nwatchEffect(() => {\n  if (appStore.isPlaying) runner.play();\n  else runner.pause();\n});\n\nwatchEffect(() => {\n  Object.assign(modelSimulator.parameters, {\n    ...modelStore.transformedParameters,\n  });\n  console.log('Update model parameters', modelSimulator.parameters);\n});\n\nrunner.tick();\n\nwatch(\n  () => appStore.isFullscreen,\n  (isFullscreen) => {\n    console.log('Fullscreen toogled');\n    ignorePromise(\n      isFullscreen\n        ? document.documentElement.requestFullscreen()\n        : document.exitFullscreen(),\n    );\n  },\n);\n\nconst enableControlPanel = ref(false);\n\nconst toggleControlPanel = () => {\n  enableControlPanel.value = !enableControlPanel.value;\n};\n\nconst toggleDeveloperMode = () => {\n  appStore.isDeveloperModeActive = !appStore.isDeveloperModeActive;\n};\n\nconst togglePlayPause = () => {\n  appStore.isPlaying = !appStore.isPlaying;\n};\n\nconst toggleFullscreen = () => {\n  appStore.isFullscreen = !appStore.isFullscreen;\n};\n\nconst toggleHighlightDerivatives = () => {\n  appStore.highlightDerivatives = !appStore.highlightDerivatives;\n};\n\nconst resetModel = modelStore.reset;\n\nonKeyStroke(HOTKEYS.controlPanel.key, toggleControlPanel);\nonKeyStroke(HOTKEYS.developerMode.key, toggleDeveloperMode);\nonKeyStroke(HOTKEYS.run.key, togglePlayPause);\nonKeyStroke(HOTKEYS.fullscreen.key, toggleFullscreen);\nonKeyStroke(HOTKEYS.highlightDerivatives.key, toggleHighlightDerivatives);\nonKeyStroke(HOTKEYS.reset.key, resetModel);\n\nwatchEffect(() => {\n  if (appStore.isPlaying) runner.play();\n  else runner.pause();\n});\n\nconst modelVisualizations = ref<Array<typeof ModelVisualization>>([]);\nonMounted(() => {\n  const tick = (deltaMs: DOMHighResTimeStamp) => {\n    /**\n     * The current record from the model store can be externally modified,\n     * e.g. through the reset function. To ensure that the simulator is in sync,\n     * some properties are copied over from the model store to the simulator.\n     *\n     * TODO: Refactor the simulator such that is uses the global state directly\n     *       to make syncing unnecessary.\n     */\n    const { parameters } = modelSimulator.record;\n    Object.assign(modelSimulator.record, modelStore.record, { parameters });\n\n    const { t: lastT } = modelSimulator.record;\n    modelSimulator.tick(deltaMs);\n    const { t: currentT } = modelSimulator.record;\n    const deltaT = currentT - lastT;\n\n    const { record } = modelSimulator;\n    modelStore.$patch({ record });\n    modelVisualizations.value.forEach((mv) =>\n      mv.update(deltaMs, deltaT, modelSimulator.record),\n    );\n  };\n  runner.on('tick', tick);\n});\n</script>\n\n<template>\n  <ScaledLetterBox\n    :target-size=\"{ width: BOARD_WIDTH, height: BOARD_HEIGHT }\"\n    class=\"scaled-letterbox\"\n    @resize=\"(scale) => (appStore.scale = scale)\"\n  >\n    <div\n      class=\"layer-panel abs-top-left\"\n      :style=\"{\n        '--app-width': BOARD_WIDTH,\n        '--app-height': BOARD_HEIGHT,\n      }\"\n    >\n      <template v-for=\"layerConfig in config.layers\">\n        <ModelVisualization\n          v-if=\"layerConfig === 'modelVisualization'\"\n          ref=\"modelVisualizations\"\n          class=\"model-visualization\"\n        />\n        <ConditionalLayer\n          v-if=\"layerConfig !== 'modelVisualization'\"\n          :layer-config=\"layerConfig\"\n        />\n      </template>\n      <ScoreTable class=\"score-top-left\" />\n      <ScoreTable class=\"score-bottom-right\" />\n    </div>\n    <div class=\"slot-panel abs-top-left\">\n      <template\n        v-for=\"slotGroupConfig in config.interaction.slotGroups\"\n        :key=\"slotGroupConfig.id\"\n      >\n        <BasicSlotGroup\n          :slot-group-config=\"slotGroupConfig\"\n          v-if=\"slotGroupConfig.type === 'basic'\"\n        ></BasicSlotGroup>\n        <ActionCardSlotGroup\n          :slot-group-config=\"slotGroupConfig\"\n          v-if=\"slotGroupConfig.type === 'action-card'\"\n        ></ActionCardSlotGroup>\n        <EventCardSlotGroup\n          :slot-group-config=\"slotGroupConfig\"\n          v-if=\"slotGroupConfig.type === 'event-card'\"\n        ></EventCardSlotGroup>\n      </template>\n    </div>\n    <div class=\"marker-panel abs-top-left\">\n      <PointerMarkerPanel v-if=\"options.usePointerMarkers\"></PointerMarkerPanel>\n      <TuioMarkerPanel\n        v-if=\"options.useTuioMarkers\"\n        class=\"pointer-events-fallthrough\"\n      ></TuioMarkerPanel>\n    </div>\n    <ResetTimeoutOverlay v-if=\"appStore.autoReset\" />\n    <ControlPanel\n      @keydown=\"$event.stopPropagation()\"\n      :disabled=\"!enableControlPanel\"\n    />\n  </ScaledLetterBox>\n</template>\n\n<style lang=\"scss\" scoped>\n.app-background {\n  background-color: black;\n  width: 100%;\n  height: 100%;\n}\n\n.layer-panel {\n  background-color: white;\n}\n\n.model-visualization {\n  width: calc(1px * var(--svg-width));\n  transform: scale(var(--svg-scale-factor));\n  transform-origin: top left;\n}\n\n.slot-panel,\n.marker-panel {\n  touch-action: none;\n}\n\n.pointer-events-fallthrough {\n  pointer-events: none;\n}\n\n.score {\n  position: absolute;\n}\n\n.score-top-left {\n  @extend .score;\n  top: 0;\n  left: 0;\n  transform-origin: center;\n  transform: rotate(180deg);\n}\n\n.score-bottom-right {\n  @extend .score;\n  bottom: 0;\n  right: 0;\n}\n</style>\n"],"names":[],"version":3,"file":"index.4e532d05.css.map"}